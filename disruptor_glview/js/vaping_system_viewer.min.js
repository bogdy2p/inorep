var _InnokinDisrupterViewer=function(){function e(e){var t=X.domElement.getBoundingClientRect();return"touchend"==e.type?Ft:(e.touches?(Ft.x=2*((e.touches[0].clientX-t.left)/X.domElement.width)-1,Ft.y=1-2*((e.touches[0].clientY-t.top)/X.domElement.height)):(Ft.x=2*((e.clientX-t.left)/X.domElement.width)-1,Ft.y=1-2*((e.clientY-t.top)/X.domElement.height)),Ft)}function t(e){if(pt){var t=parseInt(e.target.getAttribute("data-step"));isNaN(t)||t!=gt&&N(t)}return e.preventDefault&&e.preventDefault(),!1}function n(e){var t=e.target.getAttribute("data-action");switch(t){case"zoom-full":R();break;case"zoom-oled":H();break;case"completed":q();break;case"change-mod-color":var n=parseInt(e.target.getAttribute("data-coloridx"),10);if(!isNaN(n)){var o,a=Mt[1].clones[n].getObjectByName("mod_shell");a.traverse(function(e){e instanceof THREE.Mesh&&(o=e.material)}),a=rt.disrupter.getObjectByName("mod_shell"),a.traverse(function(e){e instanceof THREE.Mesh&&(e.material=o)}),lt.disrupter=Mt[1].clones[n]}break;case"change-cell-color":var n=parseInt(e.target.getAttribute("data-coloridx"),10);if(!isNaN(n)){var o,a=Mt[2].clones[n].getObjectByName("battery_shell");a.traverse(function(e){e instanceof THREE.Mesh&&(o=e.material)}),a=rt.innocell.getObjectByName("battery_shell"),a.traverse(function(e){e instanceof THREE.Mesh&&(e.material=o)}),lt.innocell=Mt[2].clones[n]}}return e.preventDefault&&e.preventDefault(),!1}function o(t){switch(t.type){case"mousedown":case"touchstart":case"pointerdown":e(t);var n=a(),o=15;if(n){for(;!(n.parent instanceof THREE.Group);)n=n.parent;var i=gt+1;switch(gt){case 1:if("disrupter"==n.name)if(n.position.y==o){lt.disrupter=n;var r,l=n.getObjectByName("mod_shell");l.traverse(function(e){e instanceof THREE.Mesh&&(r=e.material)}),rt.disrupter.getObjectByName("mod_shell").traverse(function(e){e instanceof THREE.Mesh&&(e.material=r)}),N(i)}else ct&&"disrupter"==ct.name&&$t.popout_object(ct,0),$t.popout_object(n,o),ct=n;break;case 2:if("innocell"==n.name)if(n.position.y==o+21){lt.innocell=n;var r,l=n.getObjectByName("battery_shell");l.traverse(function(e){e instanceof THREE.Mesh&&(r=e.material)}),rt.innocell.getObjectByName("battery_shell").traverse(function(e){e instanceof THREE.Mesh&&(e.material=r)}),N(i)}else ct&&"innocell"==ct.name&&$t.popout_object(ct,21),$t.popout_object(n,o+21),ct=n;break;case 3:"isub_coil02ohm"==n.name&&(n.position.y==o?(lt.coil=n,zt.ohmz=10*n.userData.ohms,"ON"===kt&&(O(),d()),pt=!0,N(i)):(ct&&"isub_coil02ohm"==ct.name&&$t.popout_object(ct,0),$t.popout_object(n,o),ct=n));break;case 4:switch(n.name){case"startbutton":"OFF"==kt?z():k();break;case"up_button":W();break;case"down_button":P()}}}break;case"mouseup":case"touchend":case"pointerup":A()}return!1}function a(){if(it.length){Z.setFromCamera(Ft,Y);var e=Z.intersectObjects(tt,!0);if(e.length)return e[0].object}return!1}function r(){requestAnimationFrame(r),l(Q.getDelta()),TWEEN.update()}function l(e){$.position.x=Y.position.x,$.position.y=Y.position.y,$.position.z=Y.position.z,TWEEN.update(),J&&J.tick(e),X.render(U,Y)}function s(e){if(!e)return ft.container=ft.container?ft.container:document.body,!1;if(e.width=parseInt(e.width),e.height=parseInt(e.height),ft.width=isNaN(e.width)?ft.width:e.width,ft.height=isNaN(e.height)?ft.height:e.height,e.containerId){var t=document.getElementById(e.containerId);t&&(ft.container=t)}else ft.container=ft.container?ft.container:document.body}function c(){for(var e in Rt)for(rt[e]=new THREE.Group,rt[e].name=e,rt[e].visible=!1,U.add(rt[e]),mt+=Rt[e].length,ut+=Rt[e].length;Rt[e].length;){var t=Rt[e].shift();p(t,e)}}function p(e,t){var n;switch(e.type){case"collada":n=THREE.ColladaLoader;break;case"obj":n=THREE.OBJLoader}var o=new n;"collada"==e.type&&(o.options.convertUpAxis=!0),o.load(bt+e.model,function(n){var o=n.scene?n.scene:n;if(rt[t].add(o),mt-=1,e.material){var a=new THREE.MeshPhongMaterial(e.material);o.traverse(function(e){e instanceof THREE.Mesh&&(e.material=a)})}if("olcd"===e.name){var a=new THREE.MeshPhongMaterial(e.material);o.traverse(function(e){e instanceof THREE.Mesh&&(e.material=a)})}["startbutton","up_button","down_button"].indexOf(e.name)>-1&&it.push(o.children[0]),e.name&&(o.name=e.name),E(),mt||D()})}function m(){if(ot=document.getElementById("WebglLoadingOverlay"),!ot){ot=document.createElement("div"),ot.className="loading-overlay",ot.id="WebglLoadingOverlay";var e=document.createElement("div");e.className="progress-bar";var t=document.createElement("div");t.className="progress-indicator",t.id="progress-indicator",t.style.width="0",e.appendChild(t),ot.appendChild(e);var n=document.createElement("div");for(n.className="loading-message-div",n.id="loading-message-div",ot.appendChild(n),St.wrapper.appendChild(ot),i=0;i<dt.length;i++){var o=document.createElement("span");o.className="loading-message-text",o.id="message-text-span-"+i,o.textContent=dt[i],n.appendChild(o)}}}function u(){var e=document.getElementById("warningbox-button");e&&St.wrapper.removeChild(e)}function d(){Qt&&clearTimeout(Kt);var e=null,t=null,n="#FF0000",o="#00FF00",a="#FFFF00",i="Too Low",r="Optimal",l="Too Hot";switch(zt.ohmz){case 5:zt.watt<=180?(e=a,t=i):zt.watt<=350?(e=o,t=r):(e=n,t=l);break;case 20:zt.watt<=80?(e=a,t=i):zt.watt<=150?(e=o,t=r):(e=n,t=l)}var s=document.getElementById("warningbox-button");if(s)s.style.backgroundColor=e,s.innerHTML=t,Qt&&(Kt=setTimeout(function(){u()},Zt));else{var c=document.createElement("span");c.className="warningbox-button",c.id="warningbox-button",c.innerHTML=t,c.style.backgroundColor=e,St.wrapper.appendChild(c),Qt&&(Kt=setTimeout(function(){u()},Zt))}}function b(){ot=document.getElementById("WebglLoadingOverlay"),ot&&ot.parentNode.removeChild(ot)}function E(){var e=document.getElementById("progress-indicator"),t=1-mt/ut;e?e.style.width=100*t+"%":console.log(100*t)}function h(){if(X){St.wrapper=document.createElement("div"),St.wrapper.className="disrupter-view-wrapper",X.domElement.className="disrupter-view-canvas",X.domElement.parentNode.appendChild(St.wrapper),St.wrapper.appendChild(X.domElement),St.wrapper.style.width=X.domElement.width+"px",St.title=document.createElement("h4"),St.title.className="step-title",St.title.id="WebGlViewerTitle",St.title.innerHTML=Mt[gt].title,St.wrapper.appendChild(St.title);var e=document.createElement("span");e.className="step-button-holder",St.wrapper.appendChild(e);var o=document.createElement("span");o.className="inner-holder",e.appendChild(o);for(var a=["mousedown","pointerdown","touchstart"],i=1;4>=i;i++){var r=document.createElement("span");r.className="step-button",r.setAttribute("data-step",i),r.innerHTML=Mt[i].icon?"&nbsp;":'<span class="step-no">'+i+".</span> "+Mt[i].title,r.className+=Mt[i].icon?" "+Mt[i].icon:"",o.appendChild(r),_t.push(r);for(var l=0;l<a.length;l++)r.addEventListener(a[l],t)}for(var s=["zoom-full","zoom-oled"],c=0;c<s.length;c++){var p=document.createElement("span");p.className="step4-tool-button "+s[c],p.setAttribute("data-action",s[c]),p.innerHTML="&nbsp;",St.wrapper.appendChild(p);for(var l=0;l<a.length;l++)p.addEventListener(a[l],n);xt.push(p)}var u=document.createElement("span");u.className="completed-button",u.id="completed-button",u.setAttribute("data-action","completed"),u.innerHTML="&nbsp;",St.wrapper.appendChild(u);for(var l=0;l<a.length;l++)u.addEventListener(a[l],n);Dt.push(u);var d=document.createElement("span");d.className="viewer-color-swatches",d.id="InnokinModSwatches";var b=document.createElement("span");b.className="part-title",b.innerHTML="Disrupter:",d.style.right="30px",d.appendChild(b);for(var E=0;E<Nt.length;E++){var h=document.createElement("span");h.className="color-swatch",h.style.backgroundColor="#"+(16777216|Nt[E].color).toString(16).substring(1),h.setAttribute("data-action","change-mod-color"),h.setAttribute("data-coloridx",E),h.innerHTML="&nbsp;",d.appendChild(h);for(var l=0;l<a.length;l++)h.addEventListener(a[l],n)}xt.push(d),St.wrapper.appendChild(d);var d=document.createElement("span");d.className="viewer-color-swatches",d.id="InnokinCellSwatches";var b=document.createElement("span");b.className="part-title",b.innerHTML="InnokinCell:",d.style.left="30px",d.appendChild(b);for(var E=0;E<Ht.length;E++){var h=document.createElement("span");h.className="color-swatch",h.style.backgroundColor="#"+(16777216|Ht[E].color).toString(16).substring(1),h.setAttribute("data-action","change-cell-color"),h.setAttribute("data-coloridx",E),h.innerHTML="&nbsp;",d.appendChild(h);for(var l=0;l<a.length;l++)h.addEventListener(a[l],n)}St.wrapper.appendChild(d),xt.push(d),m()}}function w(){rt.isub_coil02ohm.rotation.set(0,0,0),rt.isub_coil02ohm.position.set(-22.5,0,-3.5),rt.disrupter.rotation.set(0,0,0),rt.disrupter.position.set(0,0,0),rt.innocell.rotation.set(0,0,0),rt.innocell.position.set(-29.95,0,0)}function y(){for(var e in rt)rt[e].visible=!1;for(var t in Mt)if(Mt[t].clones)for(var n=0;n<Mt[t].clones.length;n++)Mt[t].clones[n].visible=!1}function T(){if(!Mt[1].clones.length){rt.step1=new THREE.Group,rt.step1.name="step1",U.add(rt.step1);for(var e=0,t=0;t<Nt.length;t++){var n=rt.disrupter.clone();rt.step1.add(n);var o=t%2?1:-1;e+=60*t*o,n.position.set(e+15,0,0),n.rotation.set(0,Math.PI/4,0);var a=n.getObjectByName("mod_shell");if(a){var i=t%Nt.length,r=new THREE.MeshPhongMaterial(Nt[i]);a.traverse(function(e){e instanceof THREE.Mesh&&(e.material=r)})}n.visible=!1,Mt[1].clones.push(n)}lt.disrupter=Mt[1].clones[0]}}function g(){if(!Mt[2].clones.length){for(var e=Math.PI/4,t=[[32.5,21,4],[26,21,-21],[4,21,-32],[-20,21,-25],[-32,21,-4],[-25,21,20],[-4,21,32],[20.5,21,26]],n=0;8>n;n++){var o=rt.innocell.clone();rt.tabletop.add(o),o.rotation.y=e*n,o.position.set(t[n][0],t[n][1],t[n][2]);var a=o.getObjectByName("battery_shell");if(a){var i=n%Ht.length,r=new THREE.MeshPhongMaterial(Ht[i]);a.traverse(function(e){e instanceof THREE.Mesh&&(e.material=r)})}o.visible=!1,Mt[2].clones.push(o)}lt.innocell=Mt[2].clones[0]}}function v(e){var t=new THREE.TextGeometry(e,{size:10,height:2,curveSegments:4,font:"droid sans",weight:"normal",style:"normal",bevelThickness:1,bevelSize:1,bevelEnabled:!1,material:0,extrudeMaterial:1});t.computeBoundingBox(),material=new THREE.MeshPhongMaterial({color:11778499,shininess:30,specular:14605286,metal:!0,shading:THREE.FlatShading});var n=-.5*(t.boundingBox.max.x-t.boundingBox.min.x),o=new THREE.Mesh(t,material);return o.position.x=n,o.position.y=60,o.position.z=0,o.rotation.x=0,o.rotation.y=0,group=new THREE.Group,group.add(o),group}function f(){if(!Mt[3].clones.length){rt.step3=new THREE.Group,rt.step3.name="step3",U.add(rt.step3);for(var e=0,t=0;t<Ct.length;t++){var n=rt.isub_coil02ohm.clone();rt.step3.add(n);var o=t%2?1:-1;n.userData.ohms=Ct[t],e+=100*t*o;var a=n.position.x;n.position.set(a+e-25,0,0),n.rotation.set(0,0,0);var i=v(Ct[t]+" Ω");n.add(i),n.visible=!1,Mt[3].clones.push(n)}lt.coil=Mt[3].clones[0]}}function _(){if(at)et.minPolarAngle=0,et.maxPolarAngle=Math.PI,et.noPan=!1;else switch(et.enabled=!0,et.minAzimuthAngle=-1/0,et.maxAzimuthAngle=1/0,et.minPolarAngle=Math.PI/3,et.maxPolarAngle=Math.PI/2,gt){case 1:et.minAzimuthAngle=-Math.PI/10,et.maxAzimuthAngle=Math.PI/10;break;case 2:et.minPolarAngle=1.25,et.maxPolarAngle=1.25,et.update();break;case 3:et.minAzimuthAngle=-Math.PI/20,et.maxAzimuthAngle=Math.PI/20,Y.position.set(2.13455,178.7043,281.966),Y.rotation.set(-.39847,.006977,.00293723),et.center.set(0,60,0),et.update();break;case 4:Y.position.set(7.4252,84.2356,163.364),Y.rotation.set(-.1473,.04493,.00666),et.center.set(0,60,0),et.maxPolarAngle=Math.PI,et.minPolarAngle=0,et.update(),et.enabled=!1}}function x(e){if(vt=gt,e=parseInt(e),e=isNaN(e)||e>4?gt:e,gt!=e){switch(gt=e,y(),_(),gt){case 1:rt.step1.visible=!0;for(var t=0;t<Mt[gt].clones.length;t++)Mt[gt].clones[t].visible=!0;tt=Mt[gt].clones;break;case 2:rt.tabletop.visible=!0;for(var t=0;t<Mt[gt].clones.length;t++)Mt[gt].clones[t].visible=!0;tt=rt.tabletop.children;break;case 3:rt.step3.visible=!0;for(var t=0;t<Mt[gt].clones.length;t++)Mt[gt].clones[t].visible=!0;tt=Mt[gt].clones;break;case 4:rt.innocell.position.y=0,rt.isub_coil02ohm.position.y=0,rt.disrupter.position.y=0,rt.innocell.visible=!0,rt.disrupter.visible=!0,rt.isub_coil02ohm.visible=!0,tt=it,InnokinDisrupterViewer.displayStartInformation()}for(var n=0;n<_t.length;n++)_t[n].className=_t[n].className.replace(/active/g," ").replace(/\s+/," ");_t[gt-1].className+=" active",document.getElementById("WebGlViewerTitle").innerHTML=Mt[gt].title;for(var n=0;n<xt.length;n++)xt[n].style.display=4==gt?"block":"none"}}function D(){w(),U.remove(rt.disrupter,rt.innocell,rt.isub_coil02ohm),nt=new THREE.Group,nt.add(rt.disrupter),nt.add(rt.innocell),nt.add(rt.isub_coil02ohm),U.add(nt),y(),T(),g(),f(),rt.tabletop.position.set(0,-21,0),b();var e=gt;gt=0,x(e),$t.step[gt]["in"](),console.clear()}function j(){if(at){et.minPolarAngle=0,et.maxPolarAngle=Math.PI,et.noPan=!1,Y.far=1e3,U.traverse(function(e){e instanceof THREE.DirectionalLight&&U.add(new THREE.DirectionalLightHelper(e,20))});var e=new THREE.GridHelper(300,10);U.add(e);var t=new THREE.AxisHelper(20);U.add(t)}}function N(e){TWEEN.removeAll(),$t.step[gt]?$t.step[gt].out(function(){x(e),$t.step[gt]["in"]()}):x(e),4!=e&&u(),console.clear()}function H(){4==gt&&(TWEEN.removeAll(),Y.position.set(7.4252,84.2356,163.364),Y.rotation.set(-.1473,.04493,.00666),et.center.set(0,60,0),w(),$t.zoom_to_oled_new(),et.enabled=at?!0:!1)}function R(){4==gt&&(TWEEN.removeAll(),w(),$t.zoom_to_fullview(),et.enabled=!0,et.minAzimuthAngle=-1/0,et.maxAzimuthAngle=1/0,et.minPolarAngle=0,et.maxPolarAngle=Math.PI)}function F(e){filter=U.getObjectByName("isub_coil02ohm"),complete_device_group=filter.parent,Vt||(J=new SPE.Group({texture:THREE.ImageUtils.loadTexture(bt+"texture/smokeparticle.png"),maxAge:5,hasPerspective:!0,colorize:!0}),K=new SPE.Emitter({position:new THREE.Vector3(-22,152,-4),positionSpread:new THREE.Vector3(0,0,0),acceleration:new THREE.Vector3(0,10,0),accelerationSpread:new THREE.Vector3(0,0,0),velocity:new THREE.Vector3(0,0,0),velocitySpread:new THREE.Vector3(10,0,10),colorStart:new THREE.Color(16777215),colorEnd:new THREE.Color(16777215),sizeStart:5,sizeEnd:150,particleCount:3*e/10}),J.addEmitter(K),st.setVolume(It),st.play(),complete_device_group.add(J.mesh),Vt=!0,L(),O(),V(),Yt=setTimeout(function(){G()},1e4))}function C(){Vt&&(filter=U.getObjectByName("isub_coil02ohm"),complete_device_group=filter.parent,complete_device_group.remove(J.mesh),Vt=!1,I(),O())}function M(e,t){switch(S(t),t){case"watt":e.drawText(ohmz_ammount_display+"Ω",11,90,"#FDFDFD","51.2px DisrupterLCDFont"),e.drawText(volt_ammount_display+"v",11,150,"#FDFDFD","51.2px DisrupterLCDFont"),e.drawText(watt_ammount_display,155,130,"#FDFDFD","76.8px DisrupterLCDFont"),e.drawText("w",285,130,"#FDFDFD","76.8px DisrupterLCDFont"),e.drawText("",345,120,"#FFFFFF","76.8px DisrupterLCDFont");break;case"volt":e.drawText(ohmz_ammount_display+"Ω",10,90,"#FDFDFD","51.2px DisrupterLCDFont"),e.drawText(watt_ammount_display+"w",12,150,"#FDFDFD","51.2px DisrupterLCDFont"),e.drawText(volt_ammount_display,150,130,"#FDFDFD","76.8px DisrupterLCDFont"),e.drawText("v",289,130,"#FDFDFD","76.8px DisrupterLCDFont"),e.drawText("",345,120,"#FFFFFF","76.8px DisrupterLCDFont")}}function S(){var e=(zt.volt/10).toString(),t=(zt.watt/10).toString(),n=(zt.ohmz/10).toString();substringOfVolt=e.substring(0,4),volt_ammount_display=substringOfVolt,watt_ammount_display=t,ohmz_ammount_display=n,zt.volt%10==0?volt_ammount_display+=".00":zt.volt%10==5&&(volt_ammount_display+="0"),watt_ammount_display=zt.watt%10==5?t:t+".0",zt.watt<100&&(watt_ammount_display=" "+watt_ammount_display),ohmz_ammount_display+=zt.ohmz%10==0?".00":"0"}function z(){var e=U.getObjectByName("startbutton"),t=0,n=0;e.position.x+=.5,Wt+=1,At+=1,"OFF"===kt&&(startButtonPushStart=Q.elapsedTime,startButtonPushed=!0,Wt%3==1&&(clearTimeout(),startClick1=Q.elapsedTime,timer_running=!0,setTimeout(function(){timer_running&&InnokinDisrupterViewer.displayStartInformation()},400)),Wt%3==2&&(clearTimeout(),startClick2=Q.elapsedTime,t=startClick2-startClick1,timer_running=!1),Wt%3==0&&(clearTimeout(),startClick3=Q.elapsedTime,n=startClick3-startClick1,timer_running=!1,InnokinDisrupterViewer.startDisruptorWithLogo(),kt="ON")),setTimeout(function(){timer_running=!0,Wt=0},600),"ON"===kt&&F(zt.watt)}function k(){var e=U.getObjectByName("startbutton");e.position.x+=.5,Vt?Bt=setTimeout(function(){complete_device_group=U.getObjectByName("disrupter").parent,complete_device_group.remove(J.mesh),Vt=!1},Gt):Ot=setTimeout(function(){F(zt.watt)},Gt)}function P(){var e=U.getObjectByName("down_button");if(e.position.x+=.3,"ON"===kt)switch(Pt){case"volt":zt.volt<74.1?zt.volt+=1:zt.volt=30,zt.volt.toFixed(2),O(),d();break;case"watt":zt.watt<496?zt.watt+=5:zt.watt=60,O(),d()}}function W(){var e=U.getObjectByName("up_button");if(e.position.x+=.3,"ON"===kt)switch(Pt){case"volt":zt.volt>31?zt.volt-=1:zt.volt=75,O(),d();break;case"watt":zt.watt>64?zt.watt-=5:zt.watt=500,O(),d()}}function A(){var e=U.getObjectByName("startbutton"),t=U.getObjectByName("up_button"),n=U.getObjectByName("down_button");e.position.x=0,t.position.x=0,n.position.x=0,startButtonPushed=!1,clearTimeout(Ot),clearTimeout(Bt),C(),st.stop()}function L(){var e=0;switch(zt.ohmz){case 20:zt.watt<285?(e=zt.watt*zt.ohmz,zt.volt=Math.sqrt(e)-.5):zt.volt=75;break;case 5:zt.watt>350,e=zt.watt*zt.ohmz,zt.volt=Math.sqrt(e)}}function I(){zt.volt=0}function O(){var e=U.getObjectByName("smallScreen"),t=new THREEx.DynamicTexture(400,200);t.name="screenDynamicTexture",t.texture.needsUpdate=!0,t.clear("#667788"),M(t,Pt);var n=new THREE.MeshBasicMaterial({map:t.texture});e.material=n}function B(){tempDynamicTexture=new THREEx.DynamicTexture(10,10),tempGeometry=new THREE.PlaneBufferGeometry(45,20,30,30),tempMaterial=new THREE.MeshBasicMaterial({map:tempDynamicTexture.texture}),tempPlane=new THREE.Mesh(tempGeometry,tempMaterial),tempPlane.name="tempScreenFarAway",tempPlane.position.z=5e3,tempPlane.position.x=5e3,tempPlane.position.y=5e3,U.add(tempPlane),tempDynamicTexture.drawTextCooked({text:"SomeRandoMText",align:"center",lineHeight:.3,fillStyle:"#FDFDFD",font:"38px DisrupterLCDFont",family:"DisrupterLCDFont"}),setTimeout(function(){U.remove(tempPlane)},2e3)}function V(){clearTimeout(qt),qt=setTimeout(function(){C()},15e3)}function G(){if(Xt){if(!Ut){Ut=!0;var e=document.getElementById("completed-button");e.style.display="block",e.style.zIndex=10}}else Xt=!0}function q(){window.open(Jt,"_blank")}var U,Y,X,J,K,Q,Z,$,et,tt,nt,ot,at=!1,it=[],rt={},lt={disrupter:null,innocell:null,coil:null},st=null,ct=null,pt=at,mt=0,ut=0,dt=["Innokin Disrupter 50W & InnokinCell","Choose Your Combo !","Please wait a moment. Thank you!","Loading..."],bt="./disruptor_glview/resources/",Et={slide_in:{src:["sounds/disrupter_lock.mp3","sounds/disrupter_lock.ogg"],obj:null},slide_out:{src:["sounds/disrupter_unlock.mp3","sounds/disrupter_unlock.ogg"],obj:null}},ht=[bt+"texture/envmap3.png",bt+"texture/envmap3.png",bt+"texture/envmap.png",bt+"texture/envmap2.png",bt+"texture/envmap3.png",bt+"texture/envmap3.png"],wt=[bt+"texture/envmap.png",bt+"texture/envmap.png",bt+"texture/envmap.png",bt+"texture/envmap.png",bt+"texture/envmap.png",bt+"texture/envmap.png"],yt=THREE.ImageUtils.loadTextureCube(ht);yt.minFilter=THREE.LinearFilter;var Tt=THREE.ImageUtils.loadTextureCube(wt);Tt.minFilter=THREE.LinearFilter;var gt=1,vt=1,ft={width:830,height:500,container:null},_t=[],xt=[],Dt=[],jt={blue_battery:{color:23483,shininess:30,specular:37871,metal:!0,side:THREE.DoubleSide},whiteblue_battery:{color:7527636,shininess:30,specular:9557981,metal:!0,side:THREE.DoubleSide},aquamarine_battery:{color:7527636,shininess:30,specular:9557981,metal:!0,side:THREE.DoubleSide},red_battery:{color:13178170,shininess:30,specular:15353456,metal:!0,side:THREE.DoubleSide},pink_battery:{color:14098309,shininess:30,specular:16406715,metal:!0,side:THREE.DoubleSide},purple_battery:{color:11290546,shininess:30,specular:13131982,metal:!0,side:THREE.DoubleSide},green_battery:{color:39738,shininess:30,specular:4965011,metal:!0,side:THREE.DoubleSide},black_battery:{color:1118481,shininess:30,specular:3815743,metal:!0,side:THREE.DoubleSide},golden_material:{color:7627861,shininess:30,specular:14865862,metal:!0,side:THREE.DoubleSide},silver_material:{color:11778499,shininess:30,specular:14605286,metal:!0,side:THREE.DoubleSide},black_material:{color:1118481,shininess:30,specular:3815743,metal:!0,side:THREE.DoubleSide},grey_metal:{color:13421772,shininess:50,specular:12303291,metal:!0,side:THREE.DoubleSide},crome_metal:{color:13421772,shininess:100,specular:16777215,metal:!0,side:THREE.DoubleSide,envMap:Tt,combine:THREE.MultiplyOperation,reflectivity:100},screws:{color:13421772,shininess:50,specular:11193565,metal:!0,side:THREE.DoubleSide},connectors:{color:10456915,shininess:50,specular:15392983,metal:!0,side:THREE.DoubleSide},texts:{color:6710886,shininess:50,specular:15392983,metal:!0,side:THREE.DoubleSide},logotexts:{color:16777215},black_plastic:{color:1118481,shininess:10,specular:15392983,metal:!1,side:THREE.DoubleSide},coil:{color:13421772,shininess:50,specular:11193565,metal:!0,side:THREE.DoubleSide},coil_glass:{color:16777215,shininess:10,specular:14540253,transparent:!0,opacity:.2,side:THREE.DoubleSide,depthWrite:!1},screen_transparent:{color:39168,shininess:10,specular:16711935,transparent:!0,opacity:.3,side:THREE.DoubleSide},defaultScreenBackground:{color:3354639,shininess:50,specular:2269376,metal:!0,side:THREE.DoubleSide},plastic_transparent:{color:16777215,specular:16777215,envMap:yt,combine:THREE.MultiplyOperation,transparent:!0,opacity:.4,reflectivity:30,shininess:80},plastic_powled:{color:16777215,specular:16777215,envMap:yt,combine:THREE.MultiplyOperation,transparent:!0,opacity:.9,reflectivity:5,shininess:40},plastic_black:{color:1118481,shininess:50,specular:16777215,side:THREE.DoubleSide},battery_bottom_text:{color:2236962,shininess:1,specular:3355443,metal:!0,side:THREE.DoubleSide}},Nt=[jt.silver_material,jt.golden_material,jt.black_material],Ht=[jt.black_battery,jt.blue_battery,jt.pink_battery,jt.red_battery,jt.green_battery,jt.purple_battery,jt.whiteblue_battery],Rt={disrupter:[{model:"obj/disrupter_shell_magnet.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/disrupter_shell_magnet2.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/upper_shell_lid.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/upper_shell_lid_coil_socket.obj",type:"obj",name:"",material:jt.connectors},{model:"obj/disrupter_bottom.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/connector_1.obj",type:"obj",name:"",material:jt.silver_material},{model:"obj/connector_2.obj",type:"obj",name:"",material:jt.connectors},{model:"obj/disrupter_screws.obj",type:"obj",name:"",material:jt.screws},{model:"obj/disrupter_bottom_screws.obj",type:"obj",name:"",material:jt.screws},{model:"obj/disrupter_ce_text.obj",type:"obj",name:"",material:jt.texts},{model:"obj/lcd_glass.obj",type:"obj",name:"",material:jt.screen_transparent},{model:"obj/power_button_led_ring.obj",type:"obj",name:"power_led",material:jt.plastic_black},{model:"obj/disrupter_shell.obj",type:"obj",name:"mod_shell",material:Nt[0]},{model:"obj/power_button.obj",type:"obj",name:"startbutton",material:jt.silver_material},{model:"obj/up_button.obj",type:"obj",name:"up_button",material:jt.silver_material},{model:"obj/down_button.obj",type:"obj",name:"down_button",material:jt.silver_material},{model:"obj/olcd.dae",type:"collada",name:"olcd",material:jt.defaultScreenBackground},{model:"obj/screen_frame.obj",type:"obj",name:"olcd_frame",material:jt.silver_material}],innocell:[{model:"obj/battery.obj",type:"obj",name:"",material:jt.black_battery},{model:"obj/battery_2.obj",type:"obj",name:"",material:jt.black_battery},{model:"obj/battery_usb.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/battery_upper_lid.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/battery_bottom.obj",type:"obj",name:"",material:jt.grey_metal},{model:"obj/innocell_text.obj",type:"obj",name:"",material:jt.logotexts},{model:"obj/battery_srews.obj",type:"obj",name:"",material:jt.screws},{model:"obj/battery_lid_screws.obj",type:"obj",name:"",material:jt.screws},{model:"obj/battery_bottom_screws.obj",type:"obj",name:"",material:jt.screws},{model:"obj/battery_bottom_text.obj",type:"obj",name:"",material:jt.battery_bottom_text},{model:"obj/battery_shell.obj",type:"obj",name:"battery_shell",material:Ht[0]}],isub_coil02ohm:[{model:"obj/coil2.obj",type:"obj",name:"",material:jt.crome_metal},{model:"obj/coil2_glass.obj",type:"obj",name:"coil_glass",material:jt.coil_glass},{model:"obj/logo_sipca.obj",type:"obj",name:"coil_logo",material:jt.plastic_black}],tabletop:[{model:"obj/carousel_top.obj",type:"obj",name:"carousel",material:jt.plastic_transparent},{model:"obj/carousel_bottom.obj",type:"obj",name:"carousel",material:jt.black_material}]},Ft=new THREE.Vector3,Ct=["0.5","2.0"],Mt={1:{title:"Choose Your Disrupter!",choose:"disrupter",clones:[]},2:{title:"Choose Your InnokinCell!",choose:"innocell",clones:[]},3:{title:"Choose your iSub Coil",choose:"isub_coil",clones:[],instructions:{ohms:{.5:"0.5Ω : Big Clouds","2.0":"2.0Ω Intense Flavors"}}},4:{title:"VAPE!",icon:"setp4-logo"}},St={title:void 0,wrapper:void 0},zt={ohmz:5,volt:0,watt:160,battery:1e3},kt="OFF",Pt="watt",Wt=0,At=0,Lt=!1,It=10,Ot=null,Bt=null,Vt=!1,Gt=100,qt=null,Ut=!1,Yt=null,Xt=!1,Jt="http://www.innokin.com",Kt=null,Qt=!1,Zt=3e3;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(function(){e(new Date)},1e3/60)}}(),window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||function(e){clearTimeout(e)};var $t={popout_object:function(e,t){new TWEEN.Tween(e.position).to({y:t},50).start()},coil_fadein:function(){rt.isub_coil02ohm.rotation.set(0,0,0),rt.isub_coil02ohm.position.set(0,0,0),rt.isub_coil02ohm.traverse(function(e){e instanceof THREE.Mesh&&new TWEEN.Tween(e.material).to({opacity:"coil_glass"==e.parent.name?jt.coil_glass.opacity:1},300).start()})},coil_fadeout:function(){rt.isub_coil02ohm.rotation.set(0,0,0),rt.isub_coil02ohm.position.set(0,0,0),rt.isub_coil02ohm.traverse(function(e){e instanceof THREE.Mesh&&(e.material.transparent=!0,new TWEEN.Tween(e.material).to({opacity:0},300).start())})},explode_disrupter:function(){w(),rt.innocell.position.x=-30,new TWEEN.Tween(rt.innocell.position).to({x:0},300).start(),new TWEEN.Tween(rt.isub_coil02ohm.position).to({y:30},300).start()},implode_disrupter:function(){w(),rt.isub_coil02ohm.position.y=30,new TWEEN.Tween(rt.innocell.position).to({x:-30},300).start(),new TWEEN.Tween(rt.isub_coil02ohm.position).to({y:0},300).start()},change_battery:function(){w(),rt.innocell.position.x=-30;var e=new TWEEN.Tween(rt.innocell.position).to({y:400},500),t=new TWEEN.Tween(rt.innocell.position).to({y:0},500);e.chain(t),e.start()},zoom_to_oled_new:function(){new TWEEN.Tween(nt.rotation).to({z:-Math.PI/2,x:Math.PI/2},800).start();new TWEEN.Tween(nt.position).to({x:-60,z:-10,y:30},800).start(),new TWEEN.Tween(Y.position).to({x:-13.676161925598056,y:63.9452391807378,z:87.23723124674612},900).start(),new TWEEN.Tween(Y.rotation).to({x:-.22118710812447032,y:-.015007889761138695,z:-.003374627986400691},900).start();var e=new TWEEN.Tween(et.center).to({x:-11.891589041561836,y:37.85999917667022,z:-28.76614107973018},900);e.onComplete(function(){et.update()}),e.start(),Lt=!0},zoom_to_fullview:function(){{var e=!1,t=1.3;new TWEEN.Tween(nt.rotation).to({z:0,x:0,y:0},800).start()}if(new TWEEN.Tween(nt.position).to({x:0,z:0,y:0},800).start(),e){new TWEEN.Tween(Y.position).to({x:-144.20119763765334*t,y:111.2972966087502*t,z:121.55749190834881*t},900).start(),new TWEEN.Tween(Y.rotation).to({x:-.2854704053759189,y:-.8427679017865717,z:-.2156764559473396},900).start();var n=new TWEEN.Tween(et.center).to({x:11.859650548162842*t,y:72.12312221743433*t,z:-11.921155841890096*t},900)}else{new TWEEN.Tween(Y.position).to({x:-162.89341428011286,y:77.50758564332119,z:106.12346383427874},900).start(),new TWEEN.Tween(Y.rotation).to({x:-.17451959700297856,y:-.8632528487934686,z:-.13319779834142856},900).start();var n=new TWEEN.Tween(et.center).to({x:-3.0760860807863835,y:53.77403961387587,z:-28.486663090380713},900)}n.onComplete(function(){et.update()}),n.start(),Lt=!1},step:{1:{"in":function(e){for(var t=800/Mt[1].clones.length,n=Mt[1].clones.length-1,o=0;o<Mt[1].clones.length;o++){Mt[1].clones[o].position.y=400,Mt[1].clones[o].rotation.y=0,new TWEEN.Tween(Mt[1].clones[o].rotation).to({y:Math.PI/4},t).delay(o*t).start();var a=new TWEEN.Tween(Mt[1].clones[o].position).to({y:0},t).delay(o*t);"function"==typeof e&&n==o&&a.onComplete(e),a.start()}new TWEEN.Tween(Y.position).to({x:7.4252,y:84.2356,z:163.364},800).start(),new TWEEN.Tween(Y.rotation).to({x:-.1473,y:.04493,z:.00666},800).start();var i=new TWEEN.Tween(et.center).to({x:0,y:60,z:0},800);i.onComplete(function(){et.update()}),i.start()},out:function(e){var t=1e3/Mt[1].clones.length,n=(Mt[1].clones.length-1,Mt[1].clones.indexOf(lt.disrupter)),o=Mt[1].clones.slice(0),a=0;for(n>-1&&(new TWEEN.Tween(Mt[1].clones[n].rotation).to({y:0},t).start(),new TWEEN.Tween(Mt[1].clones[n].position).to({y:400},t).start(),o.splice(n,1),a=1);o.length;){var i=o.shift();new TWEEN.Tween(i.rotation).to({y:0},t).delay(a*t).start();var r=new TWEEN.Tween(i.position).to({y:400},t).delay(a*t);a++,"function"!=typeof e||o.length||r.onComplete(e),r.start()}}},2:{"in":function(e){var t=.8,n=1500,o=new TWEEN.Tween(rt.tabletop.rotation).to({y:rt.tabletop.rotation.y-2*Math.PI},n);"function"==typeof e&&o.onComplete(e),o.start();for(var a=n/Mt[2].clones.length,i=0;i<Mt[2].clones.length;i++)Mt[2].clones[i].position.y=300,new TWEEN.Tween(Mt[2].clones[i].position).to({y:21},a).delay(i*a).start();new TWEEN.Tween(Y.position).to({x:2.13455*t,y:178.7043*t,z:281.966*t},n).start(),new TWEEN.Tween(Y.rotation).to({x:-.39847,y:.006977,z:.00293723},n).start();var r=new TWEEN.Tween(et.center).to({x:0*t,y:60*t,z:0*t},n);r.onComplete(function(){et.update()}),r.start()},out:function(e){var t=1500,n=new TWEEN.Tween(rt.tabletop.rotation).to({y:rt.tabletop.rotation.y+2*Math.PI},t);"function"==typeof e&&n.onComplete(e),n.start();var o=t/Mt[2].clones.length,a=(Mt[2].clones.length,Mt[2].clones.indexOf(lt.innocell));a=-1!=a?a:Mt[2].clones.length-1;for(var i=a,r=0;i>=0;i--,r++)Mt[2].clones[i].position.y=21,new TWEEN.Tween(Mt[2].clones[i].position).to({y:300},o).delay(r*o).start();for(var i=Mt[2].clones.length-1;i>a;i--,r++)Mt[2].clones[i].position.y=21,new TWEEN.Tween(Mt[2].clones[i].position).to({y:300},o).delay(r*o).start()}},3:{"in":function(e){for(var t=800/Mt[1].clones.length,n=Mt[3].clones.length-1,o=0;o<Mt[3].clones.length;o++){Mt[3].clones[o].position.y=300;var a=new TWEEN.Tween(Mt[3].clones[o].position).to({y:0},t).delay(o*t);"function"==typeof e&&n==o&&a.onComplete(e),a.start()}new TWEEN.Tween(Y.position).to({x:7.44418,y:161.250269,z:147.11240281},400).start(),new TWEEN.Tween(Y.rotation).to({x:-.225372,y:-.005534,z:-.00127},400).start();var i=new TWEEN.Tween(et.center).to({x:8.4538,y:120.4814,z:-30.71046},400);i.onComplete(function(){et.update()}),i.start()},out:function(e){var t=800/Mt[3].clones.length,n=Mt[3].clones.indexOf(lt.coil),o=Mt[3].clones.slice(0),a=0;for(n>-1&&(new TWEEN.Tween(o[n].position).to({y:300},t).start(),o.splice(n,1),a=1);o.length;){var i=o.shift(),r=new TWEEN.Tween(i.position).to({y:300},t).delay(a*t);a++,"function"!=typeof e||o.length||r.onComplete(e),r.start()}}},4:{"in":function(){w(),nt.rotation.set(0,0,0),nt.position.set(0,0,0),rt.disrupter.position.x=-400;var e=new TWEEN.Tween(rt.disrupter.position).to({x:0},300);rt.isub_coil02ohm.position.y=250;var t=new TWEEN.Tween(rt.isub_coil02ohm.position).to({y:0},300);rt.innocell.position.x=-30,rt.innocell.position.y=400;
var n=new TWEEN.Tween(rt.innocell.position).to({y:100},300);n.onComplete(function(){try{Et.slide_in.obj.play()}catch(e){}});var o=new TWEEN.Tween(rt.innocell.position).to({y:0},100);o.onComplete(function(){$t.zoom_to_oled_new()}),e.chain(t),n.chain(o),t.chain(n),e.start(),new TWEEN.Tween(Y.position).to({x:-133.1346,y:108.2085,z:207.3575},900).start(),new TWEEN.Tween(Y.rotation).to({x:-.13705,y:-.58042,z:-.0755},900).start();var a=new TWEEN.Tween(et.center).to({x:21.723,y:75.946,z:-26.5752},900);a.onComplete(function(){et.update()}),a.start()},out:function(e){w();var t=new TWEEN.Tween(nt.rotation).to({z:0,x:0,y:0},800);new TWEEN.Tween(nt.position).to({x:0,z:0,y:0},800).start(),t.onComplete(function(){try{Et.slide_out.obj.play()}catch(t){}var n=new TWEEN.Tween(rt.disrupter.position).to({x:-400},300),o=new TWEEN.Tween(rt.isub_coil02ohm.position).to({y:250},300),a=new TWEEN.Tween(rt.innocell.position).to({x:-30,y:400},300);a.chain(o),o.chain(n),"function"==typeof e&&n.onComplete(e);try{Et.slide_out.obj.play()}catch(t){}a.start()}),t.start(),new TWEEN.Tween(Y.position).to({x:-133.1346,y:108.2085,z:207.3575},600).start(),new TWEEN.Tween(Y.rotation).to({x:-.13705,y:-.58042,z:-.0755},600).start();var n=new TWEEN.Tween(et.center).to({x:21.723,y:75.946,z:-26.5752},600);n.onComplete(function(){et.update()}),n.start()}}}};this.getCamera=function(){console.log(Y.position,Y.rotation,et.center,et.target)},this.getRenderer=function(){return X},this.getScene=function(){return U},this.zoom_oled=function(){H()},this.zoom_full=function(){R()},this.Init=function(e){if(U)return!1;Q=new THREE.Clock,s(e),U=new THREE.Scene,Y=new THREE.PerspectiveCamera(50,ft.width/ft.height,1,800),Y.position.z=300,Y.position.y=60,X=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),X.setSize(ft.width,ft.height),X.autoClear=!1,X.gammaInput=!0,X.gammaOutput=!0,X.shadowMapEnabled=!0,ft.container.appendChild(X.domElement),et=new THREE.OrbitControls(Y,X.domElement),et.noPan=!0,et.noKeys=!0,et.minDistance=100,et.maxDistance=500,et.maxPolarAngle=Math.PI/2,et.minPolarAngle=Math.PI/3,et.panUp(60),et.update(),B();var t=new THREE.AudioListener;Y.add(t),st=new THREE.Audio(t),st.panner.coneOuterGain=1,st.load(bt+"sounds/vaping.ogg"),st.setRefDistance(1),st.setVolume(0),st.autoplay=!0,st.updateMatrixWorld(0,0,0);var n=.15,a=2,i=16777215,l=new THREE.DirectionalLight(i,n);l.position.set(300*a,300*a,0*a),l.name="StaticLight1",U.add(l);var p=new THREE.DirectionalLight(i,n);p.position.set(0*a,300*a,300*a),p.name="StaticLight2",U.add(p);var m=new THREE.DirectionalLight(i,n);m.position.set(0*a,-300*a,300*a),m.name="StaticLight3",U.add(m);var u=new THREE.DirectionalLight(i,n);u.position.set(-300*a,300*a,0*a),u.name="StaticLight4",U.add(u);var d=new THREE.DirectionalLight(i,n);d.position.set(0*a,-300*a,-300*a),d.name="StaticLight5",U.add(d),$=new THREE.PointLight(16777215,.1),$.position.x=Y.position.x,$.position.y=Y.position.y,$.position.z=Y.position.z,U.add($),j();try{for(var b in Et){Et[b].obj=document.createElement("audio");for(var E=0;E<Et[b].src.length;E++){var w=document.createElement("source"),y=Et[b].src[E].split(".");y=y[y.length-1],w.type="audio/"+y,w.src=bt+Et[b].src[E],Et[b].obj.appendChild(w)}Et[b].obj.load()}}catch(T){}h(),c(),r(),Z=new THREE.Raycaster;for(var g=["mousedown","mouseup","mousemove","pointerdown","pointerup","pointermove","touchstart","touchend","touchmove"],v=0;v<g.length;v++)X.domElement.addEventListener(g[v],o);return!0},this.step=function(e){console.log(e),N(e)},generalStartScreen=function(){var e=U.getObjectByName("smallScreen");e||(screenDynamicTexture=new THREEx.DynamicTexture(400,200),screenDynamicTexture.texture.anisotropy=X.getMaxAnisotropy(),planeGeometry1=new THREE.PlaneBufferGeometry(45,20,30,30),planeMaterial=new THREE.MeshBasicMaterial({map:screenDynamicTexture.texture}),ScreenPlane=new THREE.Mesh(planeGeometry1,planeMaterial),ScreenPlane.name="smallScreen",groupMecanism=U.getObjectByName("disrupter"),groupMecanism&&groupMecanism.add(ScreenPlane),ScreenPlane.position.x=-32.8,ScreenPlane.position.x=-32.8,ScreenPlane.position.z=-3.5,ScreenPlane.position.y=26.5,ScreenPlane.rotation.z=Math.PI/2,ScreenPlane.rotation.y=-Math.PI/2,screenDynamicTexture.texture.needsUpdate=!0,screenDynamicTexture.clear("#667788"),ScreenPlane.scale.x=.5,ScreenPlane.scale.y=.5,ScreenPlane.scale.z=.5)},delayStopScreen=function(e){var t=U.getObjectByName("smallScreen");t&&setTimeout(function(){groupMecanism=U.getObjectByName("disrupter"),groupMecanism.remove(ScreenPlane)},e)},instantStopScreen=function(){var e=U.getObjectByName("smallScreen");e&&setTimeout(function(){groupMecanism=U.getObjectByName("disrupter"),groupMecanism.remove(ScreenPlane)},0)},this.startDisruptorWithLogo=function(){generalStartScreen(),screenDynamicTexture.drawText("",25,130,"#FDFDFD","114px DisrupterLCDFont"),screenDynamicTexture.drawText("innokin",170,90,"#FDFDFD","38px DisrupterLCDFont"),screenDynamicTexture.drawText("technology",145,130,"#FDFDFD","38px DisrupterLCDFont"),setTimeout(function(){screenDynamicTexture.clear("#667788"),displayDisruptor()},1500)},displayDisruptor=function(){generalStartScreen(),M(screenDynamicTexture,"watt")},this.displayStartInformation=function(){generalStartScreen(),screenDynamicTexture.drawText("OFF",150,90,"#FDFDFD","51.2px DisrupterLCDFont"),screenDynamicTexture.drawText("click 3x on",45,145,"#FDFDFD","51.2px DisrupterLCDFont")}},InnokinDisrupterViewer=new _InnokinDisrupterViewer;